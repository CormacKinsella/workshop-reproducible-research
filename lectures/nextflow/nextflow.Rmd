---
title: "Making reproducible workflows with Nextflow"
subtitle: "Tools for Reproducible Research NBIS course"
output:
  xaringan::moon_reader:
      self-contained: true
      seal: false
      css: ["default", "../template.css"]
      nature:
          slideNumberFormat: ""
---

layout: true
<div class="scilife-logo"></div>
<div class="nbis-logo"></div>

---

class: center, middle

*Making reproducible workflows with*

<img src="https://nextflow-io.github.io/nf-hack18/assets/nextflow_logo.png", width=75%>

---

# Nextflow features

* .green[Generalisable]

* .green[Portable]

* .green[Scalable]

* .green[Platform-agnostic]

* Based on .green[Groovy] and Java

* Large active community in *e.g.* .green[nf-core]

---

# Concepts and nomenclature

<p style="text-align:center">
<img src="https://seqera.io/training/img/channel-process.png", width=75%>
</p>

--

* .green[Channels] contain data, *e.g.* input files

--

* .green[Processes] run some kind of code, *e.g.* a script or a command-line
  program

--

* .green[Tasks] are instances of a process, one per process input

---

# Anatomy of a Nextflow workflow

```groovy
workflow {

    // Define SRA input data channel
    Channel
        .fromList ( ["SRR935090", "SRR935091", "SRR935092"] )
        .set      { ch_sra_ids }

    // Define the workflow
    GET_SRA_BY_ACCESSION (
        ch_sra_ids
    )
    RUN_FASTQC (
        GET_SRA_BY_ACCESSION.out
    )
    RUN_MULTIQC (
        RUN_FASTQC.out.collect()
    )
}
```

--

```groovy
process GET_SRA_BY_ACCESSION {

    input:
    val(sra_id)

    output:
    tuple val(sra_id), path("${sra_id}.fastq.gz")

    script:
    """
    fastq-dump ${sra_id} > ${sra_id}.fastq.gz
    """
}
```

--

```bash
$ nextflow run main.nf
```

---

# Differences between Snakemake and Nextflow

<br>

```{r Snakemake vs. Nextflow table, echo = FALSE}
suppressPackageStartupMessages({
    library("dplyr")
    library("kableExtra")
})
data <- data.frame(Snakemake = c("Python",
                                 "Everything is a file",
                                 "Working directory",
                                 "\"Pull\"",
                                 "Yes",
                                 "No"),
                   Nextflow = c("Groovy",
                                "Can use both files and values",
                                "Each job in its own directory",
                                "\"Push\"",
                                "No",
                                "Yes"))
row.names(data) <- c("Language",
                     "Data",
                     "Execution",
                     "Philosophy",
                     "Dry-runs",
                     "Track code changes")
data %>%
    kable() %>%
    kable_styling(c("striped", "hover"), full_width = FALSE)
```

--

* .green[Question]: But, which one is the *best?*

--

* .green[Answer]: Both - it's mostly up to personal preference!

---

# Questions?
